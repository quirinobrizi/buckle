/*******************************************************************************
 * Copyright [2017] [Quirino Brizi (quirino.brizi@gmail.com)]
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/'use strict';var cov_1i318aeyl5=function(){var path='/home/quirino/Projects/buckle/src/infrastructure/adaptor/ScaleContainerAdaptor.js',hash='a58099bb01bf611ac82ddf58ce480538112b7043',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/home/quirino/Projects/buckle/src/infrastructure/adaptor/ScaleContainerAdaptor.js',statementMap:{'0':{start:{line:19,column:15},end:{line:19,column:35}},'1':{start:{line:21,column:0},end:{line:143,column:1}},'2':{start:{line:25,column:8},end:{line:25,column:96}},'3':{start:{line:26,column:8},end:{line:28,column:9}},'4':{start:{line:27,column:12},end:{line:27,column:88}},'5':{start:{line:29,column:8},end:{line:141,column:9}},'6':{start:{line:30,column:25},end:{line:32,column:36}},'7':{start:{line:33,column:25},end:{line:127,column:13}},'8':{start:{line:128,column:12},end:{line:133,column:14}},'9':{start:{line:134,column:12},end:{line:136,column:13}},'10':{start:{line:135,column:16},end:{line:135,column:69}},'11':{start:{line:137,column:12},end:{line:137,column:26}},'12':{start:{line:139,column:12},end:{line:139,column:28}},'13':{start:{line:140,column:12},end:{line:140,column:20}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:22,column:4},end:{line:22,column:5}},loc:{start:{line:22,column:18},end:{line:22,column:20}},line:22},'1':{name:'(anonymous_1)',decl:{start:{line:24,column:4},end:{line:24,column:5}},loc:{start:{line:24,column:36},end:{line:142,column:5}},line:24}},branchMap:{'0':{loc:{start:{line:26,column:8},end:{line:28,column:9}},type:'if',locations:[{start:{line:26,column:8},end:{line:28,column:9}},{start:{line:26,column:8},end:{line:28,column:9}}],line:26},'1':{loc:{start:{line:36,column:29},end:{line:36,column:63}},type:'binary-expr',locations:[{start:{line:36,column:29},end:{line:36,column:54}},{start:{line:36,column:58},end:{line:36,column:63}}],line:36},'2':{loc:{start:{line:37,column:30},end:{line:37,column:64}},type:'binary-expr',locations:[{start:{line:37,column:30},end:{line:37,column:56}},{start:{line:37,column:60},end:{line:37,column:64}}],line:37},'3':{loc:{start:{line:38,column:30},end:{line:38,column:64}},type:'binary-expr',locations:[{start:{line:38,column:30},end:{line:38,column:56}},{start:{line:38,column:60},end:{line:38,column:64}}],line:38},'4':{loc:{start:{line:40,column:21},end:{line:40,column:47}},type:'binary-expr',locations:[{start:{line:40,column:21},end:{line:40,column:38}},{start:{line:40,column:42},end:{line:40,column:47}}],line:40},'5':{loc:{start:{line:41,column:27},end:{line:41,column:59}},type:'binary-expr',locations:[{start:{line:41,column:27},end:{line:41,column:50}},{start:{line:41,column:54},end:{line:41,column:59}}],line:41},'6':{loc:{start:{line:42,column:27},end:{line:42,column:59}},type:'binary-expr',locations:[{start:{line:42,column:27},end:{line:42,column:50}},{start:{line:42,column:54},end:{line:42,column:59}}],line:42},'7':{loc:{start:{line:134,column:12},end:{line:136,column:13}},type:'if',locations:[{start:{line:134,column:12},end:{line:136,column:13}},{start:{line:134,column:12},end:{line:136,column:13}}],line:134}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0},f:{'0':0,'1':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const logger=(cov_1i318aeyl5.s[0]++,require('../Logger'));cov_1i318aeyl5.s[1]++;module.exports=class ScaleContainerAdaptor{constructor(){cov_1i318aeyl5.f[0]++;}adapt(inputs,image,clusterId){cov_1i318aeyl5.f[1]++;cov_1i318aeyl5.s[2]++;logger.info("adapting container info for scale container request with image %s",image);cov_1i318aeyl5.s[3]++;if(logger.debug){cov_1i318aeyl5.b[0][0]++;cov_1i318aeyl5.s[4]++;logger.debug("Current container configuration: %s",JSON.stringify(inputs));}else{cov_1i318aeyl5.b[0][1]++;}cov_1i318aeyl5.s[5]++;try{var labels=(cov_1i318aeyl5.s[6]++,Object.assign({'org.buckle.version':'1'},inputs.Config.Labels));var config=(cov_1i318aeyl5.s[7]++,{Domainname:inputs.Config.Domainname,User:inputs.Config.User,AttachStdin:(cov_1i318aeyl5.b[1][0]++,inputs.Config.AttachStdin)||(cov_1i318aeyl5.b[1][1]++,false),AttachStdout:(cov_1i318aeyl5.b[2][0]++,inputs.Config.AttachStdout)||(cov_1i318aeyl5.b[2][1]++,true),AttachStderr:(cov_1i318aeyl5.b[3][0]++,inputs.Config.AttachStderr)||(cov_1i318aeyl5.b[3][1]++,true),ExposedPorts:inputs.Config.ExposedPorts,Tty:(cov_1i318aeyl5.b[4][0]++,inputs.Config.Tty)||(cov_1i318aeyl5.b[4][1]++,false),OpenStdin:(cov_1i318aeyl5.b[5][0]++,inputs.Config.OpenStdin)||(cov_1i318aeyl5.b[5][1]++,false),StdinOnce:(cov_1i318aeyl5.b[6][0]++,inputs.Config.StdinOnce)||(cov_1i318aeyl5.b[6][1]++,false),Env:inputs.Config.Env,Cmd:inputs.Config.Cmd,Healthcheck:inputs.Healthcheck,ArgsEscaped:inputs.ArgsEscaped,Image:image,Volumes:inputs.Config.Volumes,WorkingDir:inputs.Config.WorkingDir,Entrypoint:inputs.Config.Entrypoint,NetworkDisabled:inputs.NetworkDisabled,OnBuild:inputs.OnBuild,Labels:labels,StopSignal:inputs.StopSignal,StopTimeout:inputs.StopTimeout,Shell:inputs.Shell,HostConfig:{CgroupParent:inputs.HostConfig.CgroupParent,BlkioWeight:inputs.HostConfig.BlkioWeight,BlkioWeightDevice:inputs.HostConfig.BlkioWeightDevice,BlkioDeviceReadBps:inputs.HostConfig.BlkioDeviceReadBps,BlkioDeviceWriteBps:inputs.HostConfig.BlkioDeviceWriteBps,BlkioDeviceReadIOps:inputs.HostConfig.BlkioDeviceReadIOps,BlkioDeviceWriteIOps:inputs.HostConfig.BlkioDeviceWriteIOps,CpuPeriod:0,CpuQuota:0,CpuShares:inputs.HostConfig.CpuShares,CpuRealtimePeriod:inputs.HostConfig.CpuRealtimePeriod,CpuRealtimeRuntime:inputs.HostConfig.CpuRealtimeRuntime,CpusetCpus:inputs.HostConfig.CpusetCpus,CpusetMems:inputs.HostConfig.CpusetMems,Devices:inputs.HostConfig.Devices,DeviceCgroupRules:inputs.HostConfig.DeviceCgroupRules,DiskQuota:inputs.HostConfig.DiskQuota,Memory:inputs.HostConfig.Memory,KernelMemory:inputs.HostConfig.KernelMemory,MemoryReservation:inputs.HostConfig.MemoryReservation,MemorySwap:inputs.HostConfig.MemorySwap,MemorySwappiness:inputs.HostConfig.MemorySwappiness,NanoCPUs:inputs.HostConfig.NanoCPUs,OomKillDisable:inputs.HostConfig.OomKillDisable,PidsLimit:inputs.HostConfig.PidsLimit,Ulimits:inputs.HostConfig.Ulimits,CpuCount:inputs.HostConfig.CpuCount,CpuPercent:inputs.HostConfig.CpuPercent,IOMaximumIOps:inputs.HostConfig.IOMaximumIOps,IOMaximumBandwidth:inputs.HostConfig.IOMaximumBandwidth,Binds:inputs.HostConfig.Binds,ContainerIDFile:inputs.HostConfig.ContainerIDFile,LogConfig:inputs.HostConfig.LogConfig,NetworkMode:inputs.HostConfig.NetworkMode,PortBindings:inputs.HostConfig.PortBindings,RestartPolicy:inputs.HostConfig.RestartPolicy,AutoRemove:inputs.HostConfig.AutoRemove,VolumeDriver:inputs.HostConfig.VolumeDriver,VolumesFrom:inputs.HostConfig.VolumesFrom,Mounts:inputs.HostConfig.Mounts,CapAdd:inputs.HostConfig.CapAdd,CapDrop:inputs.HostConfig.CapDrop,Dns:inputs.HostConfig.Dns,DnsOptions:inputs.HostConfig.DnsOptions,DnsSearch:inputs.HostConfig.DnsSearch,ExtraHosts:inputs.HostConfig.ExtraHosts,GroupAdd:inputs.HostConfig.GroupAdd,IpcMode:inputs.HostConfig.IpcMode,Cgroup:inputs.HostConfig.Cgroup,Links:inputs.HostConfig.Links,OomScoreAdj:inputs.HostConfig.OomScoreAdj,PidMode:inputs.HostConfig.PidMode,Privileged:inputs.HostConfig.Privileged,PublishAllPorts:inputs.HostConfig.PublishAllPorts,ReadonlyRootfs:inputs.HostConfig.ReadonlyRootfs,SecurityOpt:inputs.HostConfig.SecurityOpt,StorageOpt:inputs.HostConfig.StorageOpt,Tmpfs:inputs.HostConfig.Tmpfs,UTSMode:inputs.HostConfig.UTSMode,UsernsMode:inputs.HostConfig.UsernsMode,ShmSize:inputs.HostConfig.ShmSize,Sysctls:inputs.HostConfig.Sysctls,Runtime:inputs.HostConfig.Runtime,ConsoleSize:inputs.HostConfig.ConsoleSize,Isolation:inputs.HostConfig.Isolation},NetworkingConfig:{EndpointsConfig:{}}});cov_1i318aeyl5.s[8]++;config.NetworkingConfig.EndpointsConfig[inputs.HostConfig.NetworkMode]={Aliases:[clusterId],Links:inputs.NetworkSettings.Networks[inputs.HostConfig.NetworkMode].Links};cov_1i318aeyl5.s[9]++;if(logger.debug){cov_1i318aeyl5.b[7][0]++;cov_1i318aeyl5.s[10]++;logger.debug('generated configuration [%j]',config);}else{cov_1i318aeyl5.b[7][1]++;}cov_1i318aeyl5.s[11]++;return config;}catch(e){cov_1i318aeyl5.s[12]++;logger.error(e);cov_1i318aeyl5.s[13]++;throw e;}}};