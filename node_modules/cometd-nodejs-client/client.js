require('./cometd-nodejs-client').adapt();
var lib = require('cometd');

var cometd = new lib.CometD();
// Only needed for CometD <= 3.1.1.
cometd._isCrossDomain = function() {
    return false;
};

cometd.configure({
    url: 'http://localhost:8080/cometd',
    logLevel: 'debug'
});

cometd.addListener('/service/echo', function(m) {
    window.console.info('MESSAGE', m);
});

cometd.handshake(function(r) {
    if (r.successful) {
        cometd.publish('/service/echo', 'nodejs');
    }
});

var tick = setInterval(function() {
    console.log('tick');
}, 1000);

setTimeout(function() {
    cometd.disconnect();
    clearInterval(tick);
}, 5000);
